<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Homeric Hymn Oracle</title>
<style>
  body { font-family: sans-serif; max-width: 700px; margin: auto; padding: 2rem; }
  button { margin: 0.5rem; padding: 0.5rem 1rem; }
  #result { margin-top: 2rem; white-space: pre-wrap; }
</style>
</head>
<body>

<h1>Homeric Hymn Oracle</h1>
<div id="stage1">
  <p>Pick a word:</p>
  <div id="wordButtons"></div>
</div>

<div id="stage2" style="display:none">
  <p id="hymnInfo"></p>
  <p>Pick another word:</p>
  <div id="wordButtons2"></div>
</div>

<div id="result"></div>
<div id="meta1"></div>
<div id="meta2"></div>

<script>
/* === Load your hymns.json here ===
   Replace the sample data below with your full hymns.json content. */
const HYMNS = {
  "1": ["Sing, O goddess, the wrath of Achilles...", "He left the Achaeans in grief..."],
  "2": ["Of Demeter, who taught the fruits of the earth...", "The harvests bless the mortals..."],
  "3": ["To Apollo, the far-shooting god...", "He guides the bow and lyre..."]
  // ... up to "33"
};

/* === Helper functions === */

// ASCII sum of word
function wordValue(word) {
  return word.split('').reduce((sum,c)=>sum + c.charCodeAt(0), 0);
}

// Check if sentence is meaningful
function isValidSentence(s) {
  if (!s) return false;
  const cleaned = s.replace(/[\s\W]+/g, '');
  return cleaned.length >= 15;
}

// Deterministic index from word
function deterministicIndex(word, max) {
  return wordValue(word) % max;
}

// Random words (sample dictionary)
function randomWords(n) {
  const dictionary = ["and","or","the","fact","hero","goddess","sun","moon","sky","earth","fire","water","wind"];
  const words = [];
  while(words.length < n){
    const w = dictionary[Math.floor(Math.random()*dictionary.length)];
    if(!words.includes(w)) words.push(w);
  }
  return words;
}

/* === Stage 1 === */

let chosenHymn = null;

function showStage1Words() {
  const words = randomWords(3);
  const container = document.getElementById('wordButtons');
  container.innerHTML = '';
  words.forEach(word=>{
    const btn = document.createElement('button');
    btn.textContent = word;
    btn.onclick = ()=>{
      // Choose hymn deterministically
      const hymnKeys = Object.keys(HYMNS);
      const idx = wordValue(word) % hymnKeys.length;
      chosenHymn = hymnKeys[idx];
      document.getElementById('meta1').textContent =
        `You chose "${word}" → Hymn ${chosenHymn}`;
      document.getElementById('stage1').style.display = 'none';
      document.getElementById('stage2').style.display = 'block';
      showStage2Words();
    };
    container.appendChild(btn);
  });
}

/* === Stage 2 === */

function showStage2Words() {
  const words = randomWords(3);
  const container = document.getElementById('wordButtons2');
  container.innerHTML = '';

  const hymnSentencesRaw = HYMNS[chosenHymn] || [];
  const validSentences = hymnSentencesRaw.filter(isValidSentence);

  if(validSentences.length === 0){
    document.getElementById('result').textContent =
      `Hymn ${chosenHymn} has no usable sentences.`;
    return;
  }

  words.forEach(word=>{
    const btn = document.createElement('button');
    btn.textContent = word;
    btn.onclick = ()=>{
      let idx = deterministicIndex(word, validSentences.length);
      let sentence = validSentences[idx];

      // fallback: loop forward to find valid sentence
      let attempts = 0;
      while(!isValidSentence(sentence) && attempts < validSentences.length){
        idx = (idx + 1) % validSentences.length;
        sentence = validSentences[idx];
        attempts++;
      }

      if(!isValidSentence(sentence)){
        document.getElementById('result').textContent =
          `No valid sentence could be found for Hymn ${chosenHymn}.`;
        return;
      }

      document.getElementById('meta2').textContent =
        `You chose "${word}" → value ${wordValue(word)} → sentence ${idx+1}/${validSentences.length}`;

      document.getElementById('result').textContent =
        `Hymn ${chosenHymn}, Sentence ${idx+1}:\n\n${sentence}`;
    };
    container.appendChild(btn);
  });
}

/* === Init === */
showStage1Words();

</script>
</body>
</html>
